#! /bin/sh 

cd @CMAKE_INSTALL_PREFIX@/share/CoreBluron/tests/10Cells
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:@CMAKE_INSTALL_PREFIX@/lib

# clean output
rm -f out.dat

# Run the executable
srun -n2 --account=@BBPPROJECT@ @CMAKE_INSTALL_PREFIX@/bin/corebluron_exec -mpi

# diff outputed files with reference
cat out[0-9]*.dat > out_cb.dat
sort -k 1n,1n -k 2n,2n out_cb.dat > out.dat
diff out.dat @CMAKE_INSTALL_PREFIX@/share/CoreBluron/tests/10Cells/out.dat.ref > DIFF_CellSpike

if [ -s DIFF_CellsSpike ] 
then
  echo "Results are different, check the file DIFF_2CellsSpike. Test failed!"
  exit 1
else
  echo "Results are the same, test passed"
  rm -f DIFF_CellsSpike 
  rm -f out.dat
  exit 0
fi
